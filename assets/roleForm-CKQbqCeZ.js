import{W as c,g as L,r as m,R as Q,ar as G,o as H,h as W,x as l,y as t,s as J,t as p,k as a,S as V,ad as X,ae as R,a1 as Y,ay as Z,N as ee,Q as le}from"./index-CpodFpUQ.js";import{E as oe}from"./el-dialog-BdRR_6YM.js";import{a as te,E as ae}from"./el-form-item-CvcOi-Xh.js";import{a as re,b as ne,E as se}from"./menu-BR7_zR8D.js";import{E as ue}from"./el-checkbox-gOJjs20a.js";import{E as de}from"./el-col-57__bE4T.js";import{E as me,a as ie}from"./el-radio-BM65Nv2y.js";import{E as ce}from"./el-input-number--l3XrVoV.js";function pe(r){return c({url:"role/add",method:"post",data:r})}function Fe(r){return c({url:"role/list",method:"get",params:r})}function Re(r){return c({url:`role/list/${r}`,method:"get"})}function fe(r){return c({url:`/role/update/${r==null?void 0:r.roleId}`,method:"put",data:r})}function Ne(r){return c({url:`/role/delete/${r}`,method:"delete"})}function we(r){return c({url:"/role/excel/download",method:"get",params:r})}const _e={class:"dialog-footer"},ge=L({__name:"roleForm",props:{dialogVisible:{type:Boolean,default:!1},title:{default:""},id:{default:null},roleForm:{default:()=>({})}},emits:["emitAddFormBtn"],setup(r,{emit:N}){const w=N,v=m(),i=m(),b=m([]),S={children:"children",label:"menuName"},E=m(!1),f=r,n=m({roleSort:0,status:"1"}),h=m(!1),y=m(!1),_=m(!0),K=m({roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"},{min:2,max:20,message:"角色名称长度必须介于 2 和 20 之间",trigger:"blur"}],roleKey:[{required:!0,message:"角色权限不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"用户密码不能为空",trigger:"blur"}]}),T=()=>{v.value.validate(o=>{o&&X("是否确认提交？").then(()=>{n.value.menuIds=M(),n.value.roleId?fe(n.value).then(e=>{R(e.message),g()}):pe(n.value).then(e=>{R(e.message),g()})})})},g=()=>{v.value.resetFields(),w("emitAddFormBtn",!1)},A=()=>new Promise((o,e)=>{re().then(s=>{b.value=s.data,o(s)}).catch(s=>{e(s)})}),I=o=>{var s;const e=(s=i.value)==null?void 0:s.store.nodesMap;for(let d in e)e[d].expanded=o},U=o=>{var e;(e=i.value)==null||e.setCheckedNodes(o?b.value:[])},B=o=>{E.value=!o},M=()=>{var s,d;let o=(s=i.value)==null?void 0:s.getCheckedKeys(),e=(d=i.value)==null?void 0:d.getHalfCheckedKeys();return o.unshift.apply(o,e),o};return Q(async()=>{if(await A(),f.roleForm.roleId){const{menuIds:o,...e}=f.roleForm;n.value=e,G(()=>{o==null||o.forEach(s=>{var d;(d=i.value)==null||d.setChecked(s,!0,!1)}),_.value=!0})}}),(o,e)=>{const s=Y,d=te,D=ne,P=Z,q=ce,x=me,O=ie,k=ue,C=de,$=se,j=ae,F=ee,z=oe;return H(),W("div",null,[l(z,{"model-value":f.dialogVisible,title:f.title,width:"680px","before-close":g,"destroy-on-close":""},{footer:t(()=>[J("div",_e,[l(F,{type:"primary",onClick:T},{default:t(()=>[p(" 确定 ")]),_:1}),l(F,{onClick:g},{default:t(()=>[p("取消")]),_:1})])]),default:t(()=>[l(j,{model:a(n),ref_key:"formRef",ref:v,"label-width":"100px",rules:a(K)},{default:t(()=>[l(d,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(s,{modelValue:a(n).roleName,"onUpdate:modelValue":e[0]||(e[0]=u=>a(n).roleName=u),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"权限字符",prop:"roleKey"},{label:t(()=>[l(P,{content:"控制器中定义的权限字符，如：@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:t(()=>[l(D,{class:"myicon"})]),_:1}),p(" 权限字符 ")]),default:t(()=>[l(s,{modelValue:a(n).roleKey,"onUpdate:modelValue":e[1]||(e[1]=u=>a(n).roleKey=u),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),l(d,{label:"角色顺序",prop:"roleSort"},{default:t(()=>[l(q,{style:{width:"200px"},modelValue:a(n).roleSort,"onUpdate:modelValue":e[2]||(e[2]=u=>a(n).roleSort=u),placeholder:"请输入角色顺序","controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),l(d,{label:"用户状态",prop:"status"},{default:t(()=>[l(O,{modelValue:a(n).status,"onUpdate:modelValue":e[3]||(e[3]=u=>a(n).status=u)},{default:t(()=>[l(x,{value:"1"},{default:t(()=>[p("正常")]),_:1}),l(x,{value:"0"},{default:t(()=>[p("停用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"菜单权限",prop:"menuRole"},{default:t(()=>[l(C,{span:24},{default:t(()=>[l(k,{"model-value":a(h),"onUpdate:modelValue":e[4]||(e[4]=u=>V(h)?h.value=u:null),onChange:I,label:"展开/收起"},null,8,["model-value"]),l(k,{"model-value":a(y),"onUpdate:modelValue":e[5]||(e[5]=u=>V(y)?y.value=u:null),onChange:U,label:"全选/全不选"},null,8,["model-value"]),l(k,{"model-value":a(_),"onUpdate:modelValue":e[6]||(e[6]=u=>V(_)?_.value=u:null),onChange:B,label:"父子联动"},null,8,["model-value"])]),_:1}),l(C,{span:24},{default:t(()=>[l($,{ref_key:"menuTreeRef",ref:i,class:"tree-border","node-key":"id","show-checkbox":"",data:a(b),props:S,"check-strictly":a(E),"empty-text":"加载中，请稍候"},null,8,["data","check-strictly"])]),_:1})]),_:1}),l(d,{label:"备注",prop:"remark"},{default:t(()=>[l(s,{modelValue:a(n).remark,"onUpdate:modelValue":e[7]||(e[7]=u=>a(n).remark=u),placeholder:"请输入备注",type:"textarea",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])])}}}),ve=le(ge,[["__scopeId","data-v-311019fb"]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{Fe as a,we as b,Se as c,Ne as d,Re as g,ve as r,fe as u};
